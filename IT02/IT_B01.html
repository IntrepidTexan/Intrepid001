<script>
  // === CONFIG ===
  const repoOwner = "IntrepidTexan";
  const repoName = "Intrepid001";
  const folderPath = "IT02/images/Camino201306"; // â† change to any hike folder

  const gallery = document.getElementById("gallery");
  const slideshowContainer = document.getElementById("slideshow-container");
  const slideshowImg = document.getElementById("slideshow-img");
  const closeSlideshow = document.getElementById("close-slideshow");
  const prevButton = document.getElementById("prev");
  const nextButton = document.getElementById("next");

  let imageUrls = [];
  let currentIndex = 0;

  async function loadImages() {
    gallery.innerHTML = "Loading...";

    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`;

    try {
      const response = await fetch(apiUrl);
      const files = await response.json();

      imageUrls = files
        .filter(f => f.name.toLowerCase().endsWith(".jpg"))
        .sort((a, b) => a.name.localeCompare(b.name))
        .map(f => ({
          name: f.name,
          url: f.download_url
        }));

      if (imageUrls.length === 0) {
        gallery.innerHTML = "<p>No images found.</p>";
        return;
      }

      // Build gallery
      gallery.innerHTML = "";
      imageUrls.forEach((img, i) => {
        const el = document.createElement("img");
        el.src = img.url;
        el.alt = img.name;
        el.setAttribute("data-index", i);
        el.loading = "lazy";
        gallery.appendChild(el);
      });

    } catch (err) {
      console.error(err);
      gallery.innerHTML = "<p>Error loading images.</p>";
    }
  }

  function openSlideshow(startIndex) {
    currentIndex = startIndex;
    updateSlideshowImage();
    slideshowContainer.style.display = "flex";
  }

  function closeSlideshowFunction() {
    slideshowContainer.style.display = "none";
  }

  function updateSlideshowImage() {
    slideshowImg.src = imageUrls[currentIndex].url;
  }

  function showPrevImage() {
    currentIndex = (currentIndex - 1 + imageUrls.length) % imageUrls.length;
    updateSlideshowImage();
  }

  function showNextImage() {
    currentIndex = (currentIndex + 1) % imageUrls.length;
    updateSlideshowImage();
  }

  gallery.addEventListener("click", event => {
    if (event.target.tagName === "IMG") {
      const index = parseInt(event.target.getAttribute("data-index"));
      openSlideshow(index);
    }
  });

  closeSlideshow.addEventListener("click", closeSlideshowFunction);
  prevButton.addEventListener("click", showPrevImage);
  nextButton.addEventListener("click", showNextImage);

  document.addEventListener("keydown", (e) => {
    if (slideshowContainer.style.display === "flex") {
      if (e.key === "ArrowLeft") showPrevImage();
      else if (e.key === "ArrowRight") showNextImage();
      else if (e.key === "Escape") closeSlideshowFunction();
    }
  });

  // Start
  loadImages();
</script>
